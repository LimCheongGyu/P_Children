<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- mappers/file/boardMapper.xml -->
<mapper namespace="com.web.root.mybatis.board.BoardMapper">

	<resultMap  id="board" type="com.web.root.board.dto.BoardDTO">
		<id property="write_no" column="write_no"/> <!-- property는 DTO랑 column은 DB랑 같아야함  -->
		<result property="category" column="category"/>
		<result property="title" column="title"/>
		<result property="content" column="content"/>
		<result property="savedate" column="savedate"/>
		<result property="hit" column="hit"/>
		<result property="file_name" column="file_name"/>
		<result property="id" column="id"/>
	</resultMap>
	

 	<resultMap id="reply" type="com.web.root.board.dto.BoardRepDTO">
 		<result property="reply_no" column="reply_no"/>
 		<result property="depth" column="depth"/>
 		<result property="cGroup" column="cGroup"/>
		<result property="id" column="id"/>
		<result property="content" column="content"/>
		<result property="write_group" column="write_group"/>
		<result property="write_date" column="write_date"/>
	</resultMap>

	<select id="manager_board" resultMap="board">
		SELECT B.* FROM
		(SELECT ROWNUM rn, A.* FROM
		(SELECT * FROM board2 ORDER BY write_no DESC)A )B
		WHERE rn BETWEEN #{s} and #{e}
	</select>
	
	<select id="boardAllList" resultMap="board">
		SELECT B.* FROM
		(SELECT ROWNUM rn, A.* FROM
		(SELECT * FROM board2 ORDER BY write_no DESC)A )B
		WHERE rn BETWEEN #{s} and #{e}
	</select>

 	<select id="selectBoardCount" resultType="Integer">
		SELECT COUNT(*) FROM board2
	</select>
	
	<insert id="writeSave">
		INSERT INTO board2(write_no, category, id, title, content, file_name)
		VALUES(board_seq.NEXTVAL, #{category}, #{id}, #{title}, #{content}, #{file_name})
	</insert>
	
	<select id="contentView" resultMap="board">
		SELECT * FROM board2 WHERE write_no=#{write_no}
	</select>


	<update id="hitplus" parameterType="com.web.root.board.dto.BoardDTO">
		UPDATE board2 SET hit = hit+1 WHERE write_no=#{write_no}
	</update>
	
	<update id="modifySave" parameterType="com.web.root.board.dto.BoardDTO">
		UPDATE board2 SET title=#{title}, content=#{content} WHERE write_no=#{write_no}
	</update>
	
	<update id="modifySaveWithFile" parameterType="com.web.root.board.dto.BoardDTO">
		UPDATE board2 SET title=#{title}, content=#{content}, file_name=#{file_name} WHERE write_no=#{write_no}
	</update>
	
	<delete id="deleteBoard">
		DELETE FROM board2 WHERE write_no=#{write_no}
	</delete>
	
	<!-- 댓글 기능 -->
	<insert id="addReply">
		INSERT INTO reply2 VALUES(reply_seq.NEXTVAL, 0, 0, #{id}, #{content},#{write_no} ,SYSDATE)
	</insert>
	
	<select id="getRepList" resultMap="reply">
		SELECT * FROM reply2 WHERE write_group=#{write_group}
		ORDER BY write_date DESC
	</select>

	<delete id="deleteReply">
		DELETE FROM reply2 WHERE reply_no=#{reply_no} AND write_group=#{write_group}
	</delete>
	
	<update id="updateReply">
		UPDATE reply2 SET content=#{updateContent} WHERE id=#{id} AND reply_no=#{updateReply_no}
	</update>
	
	<!-- 답글 기능 -->
	<select id="getReCommentList" resultMap="reply">
		SELECT * FROM reply2 WHERE cGroup = #{reply_no}
		ORDER BY write_date
	</select>
	
	<insert id="addReComment">
		INSERT INTO reply2 VALUES(reply_seq.NEXTVAL, 1, #{cGroup}, #{id}, #{reCommentContent},#{write_no} ,SYSDATE)
	</insert>
	
	<update id="updateReComment">
		UPDATE reply2 SET content=#{updateContent} WHERE id=#{id} AND reply_no=#{updateReply_no}
	</update>
	
</mapper>
